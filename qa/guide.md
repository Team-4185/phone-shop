## Як тестувати код?

Для тестування коду ми вирішили використовувати [Docker](https://www.docker.com/), який дозволяє підняти увесь
застосунок
разом з базою даних одним махом локально.
Ми відмовились від ідеї тестування застосунку безпосередньо на `prod` середовищі, адже розуміємо, що тестування
передбачає
велику кількість маніпуляцій з даними, що просто заб'є базу даних зайвими даними.
Для кожної задачі тестування, вам буде необхідно підіймати увесь застосунок
використовуючи [Docker](https://www.docker.com/)
заново, але для цього вам потрібно буде лише запустити один скрипт `setup.sh` або `setup.bat`(в залежності від
операційної системи).

Важливо розуміти, що таким чином ви тестуєте саме **backend side** та його API.

### Що я цим запускаю?

Коли ви запускаєте скрипт `setup.sh` або `setup.bat`, то він підіймає два контейнери:<br>
**Перший контейнер** - це база даних [Postgres](https://www.postgresql.org/), яка вже мінімально налаштована.<br>
**Другий контейнер** - це сам застосунок, який розробляють `backend` розробники, і яким вам потрібно тестувати.

Ці два контейнери вже пов'язані між собою, і вони вже правильно взаємодіють між собою.

> Ви можете вільно підключатись до бази даних, та взаємодіяти з нею. Але важливо розуміти,
> що дані з бази даних зберігаються навіть після того, як ви
> видалили [контейнер](https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-a-container/).

### Що необхідно?

Для того, щоб правильно запустити застосунки, вам потрібно:

- [Docker Desktop](https://docs.docker.com/desktop/setup/install/windows-install/)
  встановлений та запущений на вашому комп'ютері - саме через нього ми будемо підіймати все.
- [Git](https://git-scm.com/downloads) встановлений на вашому комп'ютері - використовуємо для стягнення останньої версії
  проєкту.
- [Змінні середовища](https://uk.wikipedia.org/wiki/%D0%97%D0%BC%D1%96%D0%BD%D0%BD%D1%96_%D1%81%D0%B5%D1%80%D0%B5%D0%B4%D0%BE%D0%B2%D0%B8%D1%89%D0%B0) -
  це спеціальні змінні, де ми вказуємо значення під час запуску нашого застосунку. Ці змінні зберігаються
  в спеціальному файлі. Важливо розуміти, що для різних версій програми можуть бути різні файли змінних середовища.

> Змінні середовища треба брати в backend розробника або QA ментора.

### Я вже все маю, давай запускати

Тож, ще раз переконайтесь, що ви вже маєте усі встановленні на вашому PC програми,
а також маєте файлик з усіма змінними середовища(`test.env`).
**Кроки:**

1. Для зручної роботи, рекомендовано створити окрему папку для роботи, на вашому робочому столі. Не важливо, як її
   називати.
2. Далі, перейдіть в директорію для роботи
3. Відкрийте термінал `Git`:
    - натисніть на область у відкритій папці правою кнопкою миші
    - якщо у вас свтоновлений git на ваш PC, то у вас має бути опція `Open Git Bash here`.
    - натисніть на цю опцію, таким чином ви відкриєте термінал для роботи з Git
4. Введіть команду `git clone https://github.com/Team-4185/phone-shop.git` та дочекайтесь завантаження
5. Після цього, переконайтесь що в робочій директорії з'явилась папка з назвою `phone-shop`.
6. Після цього вам потрібно перейти в директорію `phone-shop -> qa`, та переконатись, що ви бачите там файли, з
   назвами `setup`
7. Вам потрібно покласти в цю директорію файл зі змінними середовища. Файл має бути виключно в цій директорії, та
   виключно з назвою `test` та розширенням `.env`.
8. Переконайтесь, що у вас запущений **Docker Desktop**
9. Запустіть скрипт:
    - якщо у вас Windows OS:
        - Вам потрібно запустити файл `setup.bat` від імені адміністратора
        - Дочекатись, доки в **Docker Desktop** у вкладці Containers не з'явиться контейнер з
          назвою `gadget-room-backend`
        - Працюйте..
    - якщо у вас Linux OS:
        - Вам потрібно відкрити термінал в цій директорії
        - ввести команду `sudo chmod +x ./setup.sh`
        - ввести команду `./setup.sh`
        - Дочекатись, доки в **Docker Desktop** у вкладці Containers не з'явиться контейнер з
          назвою `gadget-room-backend`
        - Працюйте..
10. Зробіть запит в браузері `http://localhost:8080/docs`

> **Примітка:** Якщо у вас випала помилка, або не піднявся контейнер, спробуйте зробити це ще раз.
  Якщо контейнер не піднявся знову, спробуйте видалити те що було до цього з **Docker Desktop**
  та спробуйте підняти ще раз. Буває таке, що з першого разу може не піднятись, бо, наприклад при завантаженні 
  залежності однієї з 200, вилетіла 500, чомусь. Наступна спроба може бути вдала. (я з таким стикався просто)

### Як мені під'єднатись до бази даних?

Для підключення до бази даних вам знадобиться будь-який клієнт для роботи з PostgreSQL. Ми рекомендуємо використовувати
один з наступних:

- [DBeaver](https://dbeaver.io/download/) (безкоштовний, зручний)
- [pgAdmin](https://www.pgadmin.org/download/) (офіційний клієнт PostgreSQL)
- [DataGrip](https://www.jetbrains.com/datagrip/) (платний, від JetBrains)

**Параметри підключення:**

| Параметр | Значення     |
|:---------|--------------|
| Host     | `localhost`  |
| Port     | `5544`       |
| Database | `gadgetroom` |
| Username | `postgres`   |
| Password | `pass1234`   |

**Приклад підключення в DBeaver:**

1. Відкрийте DBeaver
2. Натисніть `Database` → `New Database Connection`
3. Виберіть `PostgreSQL` → `Next`
4. Заповніть поля:
    - **Host:** `localhost`
    - **Port:** `5544`
    - **Database:** `gadgetroom`
    - **Username:** `postgres`
    - **Password:** `pass1234`
5. Натисніть `Test Connection` для перевірки
6. Натисніть `Finish`

> **Важливо:** База даних доступна тільки поки запущений Docker контейнер `gadget-room-backend`. Якщо контейнер зупинено -
  підключитись не вдасться.

> **Примітка:** Дані в базі даних зберігаються навіть після перезапуску контейнерів завдяки Docker
  volume `gadget-room-postgres-volume`.

### Як мені подивитись сховище зображень

Для зберігання зображень,
використовується [minio](https://mivocloud.com/ru/blog/CHto-takoe-obiektnoe-hranilishche-Minio-i-kak-ono-rabotaet).
**Minio** є open-source легковісним сховищем файлів. Його легко підняти та легко та зрозуміло працювати з ним. Мало
того, його API
розроблено таким чином, що він задовільняє специфікацію [S3](https://ru.wikipedia.org/wiki/Amazon_S3),
uі можна його замінити на [версію від Amazon](https://aws.amazon.com/ru/s3/?nc=sn&loc=0) (або навпаки).
Зараз **minio** намагаються комерціалізувати, тому на [офіційних ресурсах](https://www.min.io/) вий можете і не знайти
його,
бо його намагаються сховати, і продати вам їх новий продукт [AIStor](https://www.min.io/), який є по суті платною
версією **Minio**.

**Minio** підіймає сервер, де і зберігає усі зображення. Якщо ви захочете попрацювати з сервером напряму,
то зверніться за url:

```
http://localhost:9000
```

Для зручної роботи вручну, також існує клієнт, який піднятий на порту:

```
http://localhost:9001
```
Після першого запиту на зберігання зображення, створиться [bucket](https://www.techtarget.com/searchaws/definition/AWS-bucket)
на ім'я `images`, де і будуть зберігатись усі зображення.

Креди до minio (це валідно і для клієнта і для сервера):

| Параметер | Значення         |
|-----------|------------------|
| Username  | 'minio-user'     |
| Password  | 'minio-password' |

> **Важливо:** Minio сховище доступне тільки поки запущений Docker контейнер `gadget-room-backend`. Якщо контейнер зупинено -
  підключитись не вдасться.

> **Примітка:** Дані в базі даних зберігаються навіть після перезапуску контейнерів завдяки Docker
  volume `gadget-room-minio-volume`.

### Які подивитись доступні endpoint-и?

У вас є декілька опцій:

- `http://localhost:8080/docs` - отримати візуальний вигляд усього API
- `http://localhost:8080/docs/api-docs` - отримати JSON об'єкт усіх endpoint-ів